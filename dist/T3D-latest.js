!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).T3D=e()}}(function(){return function(){return function e(a,t,r){function n(o,s){if(!t[o]){if(!a[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(i)return i(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var m=t[o]={exports:{}};a[o][0].call(m.exports,function(e){return n(a[o][1][e]||e)},m,m.exports,e,a,t,r)}return t[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}}()({1:[function(e,a,t){const r=e("../util/MathUtils");function n(e){var a={};if(a.version=e.readUint8(),a.magic=e.readString(3),a.headerSize=e.readUint32(),e.seek(e.position+4),a.chunkSize=e.readUint32(),a.crc=e.readUint32(),e.seek(e.position+4),a.mftOffset=r.arr32To64([e.readUint32(),e.readUint32()]),a.mftSize=e.readUint32(),a.flags=e.readUint32(),"AN"==a.magic)return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded Main .dat header"),a;T3D.Logger.log(T3D.Logger.TYPE_ERROR,"ANDat header is not valid",a.magic)}function i(e){var a={};if(a.magic=e.readString(4),e.seek(e.position+8),a.nbOfEntries=e.readUint32(),e.seek(e.position+4+4),"Mft"!=a.magic)return void T3D.Logger.log(T3D.Logger.TYPE_ERROR,"MFTTable header is not valid",a.magic);let t=[];for(let n=1;n<a.nbOfEntries;n++){let a={};a.offset=r.arr32To64([e.readUint32(),e.readUint32()]),a.size=e.readUint32(),a.compressed=e.readUint16(),e.seek(e.position+4+2),a.crc=e.readUint32(),t[n]=a}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded MFTTable"),{header:a,table:t,mftIndexOffset:t[2].offset,mftIndexSize:t[2].size}}function o(e,a){let t=a/8,r=[];for(let a=0;a<t;a++){let a=e.readUint32(),t=e.readUint32();r[a]=t}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Finished indexing MFT"),r}function s(e,a,t){return new Promise((r,n)=>{let i=new FileReader;i.onerror=n,i.onload=(e=>{var a=e.target.result,n=new DataStream(a);n.endianness=DataStream.LITTLE_ENDIAN,r({ds:n,len:t})}),i.readAsArrayBuffer(e.slice(a,a+t))})}a.exports={readArchive:async function(e){let a=n((await s(e,0,40)).ds),t=i((await s(e,a.mftOffset,a.mftSize)).ds),{ds:r,len:l}=await s(e,t.mftIndexOffset,t.mftIndexSize),d=o(r,l);return{archiveHeader:a,metaTable:t.table,indexTable:d}},parseANDatHeader:n,parseMFTTable:i,parseMFTIndex:o,getFilePart:s}},{"../util/MathUtils":23}],2:[function(e,a,t){a.exports=class DataReader{constructor(e){this._settings=e,this._workerPool=[],this._workerLoad=[],this._handleCounter=0,this._workQueue=[],this._handleRegister={};for(let a=0;a<e.workersNb;a++)this._startWorker(e.workerPath)}inflate(e,a,t,r,n){return new Promise((i,o)=>{let s=e.buffer;if((!n||n<0)&&(n=0),s.byteLength<12)return T3D.Logger.log(T3D.Logger.TYPE_WARNING,`not inflating, length is too short (${s.byteLength})`,t),void o(new Error("Couldn't inflate "+t+" (mftId)"));this._workQueue.push({buffer:s,size:a,mftId:t,isImage:r,capLength:n,resolve:i,reject:o});const l=this._getFreeWorkerIndex();l>=0&&this._workNext(l)})}_workNext(e){const a=this._workQueue.shift();if(a){const t=this._getNewHandle();this._handleRegister[t]={mftId:a.mftId,workerId:e,resolve:a.resolve,reject:a.reject},this._workerLoad[e]+=1,this._workerPool[e].postMessage([t,a.buffer,!0===a.isImage,a.capLength])}}_getNewHandle(){return this._handleCounter++}_startWorker(e,a){let t,r=new Worker(e);if(a)t=a,this._workerPool[t]=r,this._workerLoad[t]=0;else if(t=this._workerPool.push(r)-1,this._workerLoad.push(0)!=t+1)throw new Error("WorkerLoad and WorkerPool don't have the same length");r.onmessage=(e=>{const a=e.data;let r;if(this._workerLoad[t]-=1,"string"==typeof a){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Inflater threw an error",a),r=a.split(":")[0];const e=this._handleRegister[r];e&&(e.reject(`Error: ${a}`),delete this._handleRegister[r])}else{r=a[0];const e=this._handleRegister[r];e?(e.resolve({buffer:a[1],dxtType:a[2],imageWidth:a[3],imageHeight:a[4]}),delete this._handleRegister[r]):T3D.Logger.log(T3D.Logger.TYPE_ERROR,"Inflater threw an error",a)}this._workNext(t)}),r.onerror=(e=>{for(let e in this._handleRegister)this._handleRegister[e].workerId===t&&(this._handleRegister[e].reject(`Error: Worker crashed while processing ${handleData.mftId}`),delete this._handleRegister[e]);this._workerPool[t].terminate(),this._startWorker(this._settings.workerPath,t)})}_getFreeWorkerIndex(){return this._workerLoad.indexOf(0)}}},{}],3:[function(e,a,t){const r=e("../format/file/GW2File.js");let n={getFileType:e=>{let a=e.readCString(4);switch(a){case"ATEC":return"TEXTURE_ATEC";case"ATEP":return"TEXTURE_ATEP";case"ATET":return"TEXTURE_ATET";case"ATEU":return"TEXTURE_ATEU";case"ATEX":return"TEXTURE_ATEX";case"ATTX":return"TEXTURE_ATTX"}if(0===a.indexOf("DDS"))return"TEXTURE_DDS";if(1===a.indexOf("PNG"))return"TEXTURE_PNG";if(0===a.indexOf("RIFF"))return"TEXTURE_RIFF";if(0===a.indexOf("YUI"))return"TEXT_YUI";if(0===a.indexOf("PF")){return"PF_"+new r(e,0,!0).header.type}return 0===a.indexOf("MZ")?"BINARIES":0===a.indexOf("strs")?"STRINGS":0===a.indexOf("asnd")?"CHUNK_ASND":"UNKNOWN"}};a.exports=n},{"../format/file/GW2File.js":18}],4:[function(e,a,t){const r=e("./ArchiveParser"),n=e("./PersistantStore"),i=e("./DataReader"),o=e("../MapFileList"),s=e("./FileTypes");a.exports=class LocalReader{constructor(e){this._settings=e,this._dataReader=new i(e),this._persistantStore,this._file=void 0,this._indexTable=[],this._fileMetaTable=[],!1!==e.noIndexedDB&&(this._persistantStore=new n)}async openArchive(e){let{archiveHeader:a,metaTable:t,indexTable:n}=await r.readArchive(e);this._fileMetaTable=t,this._indexTable=n,this._file=e}getFileIndex(e){return this._indexTable[e]}getFileMeta(e){return this._fileMetaTable[e]}async readFile(e,a,t,n,i,o){if(o){const a=e;if(!((e=this.getFileIndex(a))>0))throw new Error(`Unexistant file: ${a} (baseId)`)}let s=this.getFileMeta(e);if(!s)throw new Error(`Unexistant file: ${e} (mftId)`);let{ds:l,len:d}=await r.getFilePart(this._file,s.offset,n||s.size);if(s.compressed||0!=t){let t;return await this._dataReader.inflate(l,d,e,a,i||0).then(e=>{t=e}).catch(e=>{t={buffer:void 0,dxtType:void 0,imageWidth:void 0,imageHeight:void 0}}),t}return{buffer:l.buffer}}async readFileList(e){let a,t=e||[];if(this._persistantStore){let e=await this._persistantStore.getLastListing(this._file.name);t=e.array,e.complete||(a=e.key)}let r=Object.keys(this._indexTable).map(e=>Number(e));for(let e in t)e in this._indexTable||r.push(e);let n=[];for(let e=0;e<1;e++)n[e]=Promise.resolve({task:e});let i=!1;for(let e in r){let o=r[e],s=this._needsScan(o,t);if(1==s.scan){let e=(await Promise.race(n)).task;n[e]=this.readFileType(o).then(a=>(t[o]={baseId:o,size:a.size,crc:a.crc,fileType:a.fileType},{task:e}))}"removed"==s.change&&delete t[o],"none"!==s.change&&(i=!0),e%Math.floor(r.length/100)==0&&(T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Finding types",e/Math.floor(r.length/100)),this._persistantStore&&i&&(i=!1,this._persistantStore.putListing(a,t,this._file.name,!1).then(e=>a=e)))}return await Promise.all(n).then(()=>{this._persistantStore&&this._persistantStore.putListing(a,t,this._file.name,!0)}),this._persistantData=t,this.getFileList()}getMapList(){let e=[];if(this._persistantData){let a=this.getReverseIndex(),t=this._persistantData.filter(e=>"PF_mapc"===e.fileType).filter(e=>e.baseId==a[this.getFileIndex(e.baseId)][0]);for(let a of t){let t=!1;for(let r of o.maps){let n=r.maps.find(e=>Number(e.fileName.split(".data")[0])==a.baseId);if(n){e.push({name:n.name,category:r.name,baseId:a.baseId}),t=!0;break}}t||e.push({name:a.baseId.toString(),category:"Uncategorized",baseId:a.baseId})}}else for(let a of o.maps)for(let t of a.maps)Number(t.fileName.split(".data")[0])in this._indexTable&&e.push({name:t.name,category:a.name,baseId:Number(t.fileName.split(".data")[0])});return e}getFileList(){let e=this._persistantData?this._persistantData.map(e=>e.fileType):[],a=this.getReverseIndex(),t=this._fileMetaTable.map((t,r)=>{let n=a[r]?a[r]:[],i=a[r]?e[n[0]]:"Non-Registered";return{mftId:r,baseIdList:n,size:t.size,crc:t.crc,fileType:i}});return t[0]={mftId:0,baseIdList:[],size:0,crc:0,fileType:"Non-Registered"},t}getReverseIndex(){return this._indexTable.reduce((e,a,t)=>(a in e?e[a].push(t):e[a]=[t],e),[])}readMapListAsync(e,a){function t(e){let a=[];for(let t of e){let e=a.findIndex(e=>e.name==t.category);-1==e&&(e=a.push({name:t.category,maps:[]})-1),a[e].maps.push({fileName:t.baseId,name:t.name})}return a.sort((e,a)=>e.name<a.name?-1:e.name>a.name?1:0),{maps:a}}T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readMapListAsync is deprecated !"),e?this.readFileList().then(()=>{a(t(this.getMapList()))}):a(t(this.getMapList()))}readFileListAsync(e){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readFileListAsync is deprecated !"),this.readFileList().then(a=>{let t={};for(let e of a)void 0===t[e.fileType]&&(t[e.fileType]=[]),t[e.fileType].push(e.mftId);e(t)})}loadFile(e,a,t,r){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFile is deprecated !"),this.readFile(e,t,r,void 0,void 0,!0).then(e=>{if(null==e.buffer)return a(null);a(e.buffer,e.dxtType,e.imageWidth,e.imageHeight)})}loadTextureFile(e,a){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadTextureFile is deprecated !"),this.readFile(e,isImage,raw,void 0,void 0,!0).then(e=>{if(null==e.buffer)return a(null);a(e.buffer,e.dxtType,e.imageWidth,e.imageHeight)})}loadFileList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFileList is deprecated !")}loadMapList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadMapList is deprecated !")}_needsScan(e,a){if(e<=0)return{change:"none",scan:!1};let t=this.getFileIndex(e),r=this.getFileMeta(t);return void 0!==r||e in a?void 0===r?{change:"removed",scan:!1}:e in a?r.size!==a[e].size||r.crc!==a[e].crc?{change:"modified",scan:!0}:{change:"none",scan:!1}:{change:"added",scan:!0}:{change:"none",scan:!1}}async readFileType(e){this._fileTypeCache||(this._fileTypeCache=[]);let a,t=this.getFileIndex(e),r=this.getFileMeta(t);if(null!=this._fileTypeCache[e])a=this._fileTypeCache[e];else{let e=(await this.readFile(t,!1,!1,Math.min(r.size,1e3),32)).buffer;if(null==e)return;a=s.getFileType(new DataStream(e))}return{fileType:a,crc:r.crc,size:r.size}}}},{"../MapFileList":7,"./ArchiveParser":1,"./DataReader":2,"./FileTypes":3,"./PersistantStore":5}],5:[function(e,a,t){e("../T3DLib").version;const r=4;a.exports=class PersistantStore{constructor(){this._dbConnection=void 0,this._getConnection(()=>{})}_getConnection(){return new Promise((e,a)=>{this._dbConnection&&e(this._dbConnection);let t=window.indexedDB.open("Tyria3DLibrary",r);t.onblocked=(e=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database cannot be upgraded while the app is opened somewhere else.")}),t.onupgradeneeded=(e=>{let a=e.target.result,t=e.oldVersion;t<2&&a.createObjectStore("listings",{autoIncrement:!0}),t<3&&e.currentTarget.transaction.objectStore("listings").createIndex("filename","filename",{unique:!1})}),t.onsuccess=(a=>{this._dbConnection=a.target.result,this.isReady=!0,e(this._dbConnection)}),t.onerror=(e=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database could not be opened."),a()})})}putListing(e,a,t,r){return new Promise((n,i)=>{this._getConnection().then(o=>{let s=o.transaction(["listings"],"readwrite").objectStore("listings"),l=e?s.put({array:a,filename:t,complete:r},e):s.put({array:a,name:t});l.onsuccess=(e=>{n(l.result)}),l.onerror=(e=>{i()})})})}getLastListing(e){return new Promise((a,t)=>{this._getConnection().then(t=>{t.transaction(["listings"],"readonly").objectStore("listings").index("filename").openCursor(IDBKeyRange.only(e),"prev").onsuccess=(e=>{let t=e.target.result;a(t?{array:t.value.array,key:t.primaryKey,complete:t.value.complete}:{array:[],key:void 0,complete:!0})})})})}}},{"../T3DLib":8}],6:[function(e,a,t){var r={TYPE_ERROR:4,TYPE_WARNING:3,TYPE_MESSAGE:2,TYPE_PROGRESS:1,TYPE_DEBUG:0};r.logFunctions=new Array(5),r.log=function(){if(0!=arguments.length){var e=r.argsToArr(arguments);1==e.length&&e.unshift(r.TYPE_MESSAGE);var a=Math.max(0,Math.min(r.logFunctions.length,e.shift()));r.logFunctions[a].apply(this,e)}},r.argsToArr=function(e){for(var a=new Array(e.length),t=0;t<a.length;++t)a[t]=e[t];return a},r.logFunctions[r.TYPE_ERROR]=function(){console.error.apply(console,arguments)},r.logFunctions[r.TYPE_WARNING]=function(){console.warn.apply(console,arguments)},r.logFunctions[r.TYPE_MESSAGE]=function(){console.log.apply(console,arguments)},r.logFunctions[r.TYPE_PROGRESS]=function(){var e=r.argsToArr(arguments);e.unshift("Progress: "),console.log.apply(console,e)},r.logFunctions[r.TYPE_DEBUG]=function(){var e=r.argsToArr(arguments);console.debug.apply(console,e)},a.exports=r},{}],7:[function(e,a,t){a.exports={maps:[{name:"01. Shiverpeaks",maps:[{fileName:"125199.data",name:"Wayfarer Foothills (0)"},{fileName:"187611.data",name:"Wayfarer Foothills (1)"},{fileName:"568778.data",name:"Cragstead"},{fileName:"132434.data",name:"Hoelbrak (0)"},{fileName:"197122.data",name:"Hoelbrak (1)"},{fileName:"1966018.data",name:"Hoelbrak (2)"},{fileName:"124093.data",name:"Snowden Drifts (0)"},{fileName:"186397.data",name:"Snowden Drifts (1)"},{fileName:"275155.data",name:"Dredgehaunt Cliffs"},{fileName:"276252.data",name:"Frostgorge Sound"},{fileName:"277587.data",name:"Lornar's Pass"},{fileName:"278717.data",name:"Timberline Falls (0)"},{fileName:"846866.data",name:"Timberline Falls (1)"},{fileName:"1018612.data",name:"Timberline Falls (2)"},{fileName:"295282.data",name:"Eye of the North"}]},{name:"02. Ascalon",maps:[{fileName:"126118.data",name:"Plains of Ashford (0)"},{fileName:"188591.data",name:"Plains of Ashford (1)"},{fileName:"127888.data",name:"Diessa Plateau (0)"},{fileName:"190490.data",name:"Diessa Plateau (1)"},{fileName:"131944.data",name:"Black Citadel (0)"},{fileName:"196585.data",name:"Black Citadel (1)"},{fileName:"1968107.data",name:"Black Citadel (2)"},{fileName:"280025.data",name:"Blazeridge Steppes"},{fileName:"281313.data",name:"Fireheart Rise"},{fileName:"282668.data",name:"Iron Marches"},{fileName:"283574.data",name:"Fields of Ruin"}]},{name:"03. Kryta",maps:[{fileName:"191000.data",name:"Lion's Arch (0)"},{fileName:"814803.data",name:"Lion's Arch (1)"},{fileName:"1019669.data",name:"Lion's Arch (Legacy)"},{fileName:"1796999.data",name:"Lion's Arch (2)"},{fileName:"1869665.data",name:"Lion's Arch (3)"},{fileName:"1968576.data",name:"Lion's Arch (4)"},{fileName:"128151.data",name:"Divinity's Reach (0)"},{fileName:"191265.data",name:"Divinity's Reach (1)"},{fileName:"705746.data",name:"Divinity's Reach (2)"},{fileName:"1968748.data",name:"Divinity's Reach (3)"},{fileName:"129834.data",name:"North of Divinity's Reach (0)"},{fileName:"193081.data",name:"North of Divinity's Reach (1)"},{fileName:"129524.data",name:"Queensdale (0)"},{fileName:"192711.data",name:"Queensdale (1)"},{fileName:"130970.data",name:"Kessex Hills (0)"},{fileName:"194288.data",name:"Kessex Hills (1)"},{fileName:"672138.data",name:"Kessex Hills (2)"},{fileName:"861815.data",name:"Kessex Hills (3)"},{fileName:"286945.data",name:"Bloodtide Coast"},{fileName:"287870.data",name:"Harathi Hinterlands"},{fileName:"289176.data",name:"Gendarran Fields"},{fileName:"295005.data",name:"Chantry of Secrets"},{fileName:"294938.data",name:"Claw Island"}]},{name:"04. Maguuma Jungle",maps:[{fileName:"195149.data",name:"Caledon Forest"},{fileName:"195493.data",name:"Metrica Province"},{fileName:"922320.data",name:"Metrica Province Instance"},{fileName:"198076.data",name:"The Grove (0)"},{fileName:"1969341.data",name:"The Grove (1)"},{fileName:"198272.data",name:"Rata Sum (0)"},{fileName:"1968896.data",name:"Rata Sum (1)"},{fileName:"291064.data",name:"Mount Maelstrom"},{fileName:"292254.data",name:"Sparkfly Fen"},{fileName:"293307.data",name:"Brisban Wildlands"}]},{name:"05. Ruins of Orr",maps:[{fileName:"284829.data",name:"Straits of Devastation"},{fileName:"285089.data",name:"Malchor's Leap"},{fileName:"285634.data",name:"Cursed Shore"},{fileName:"295179.data",name:"Cathedral of Hidden Depths"},{fileName:"295962.data",name:"A Light in the Darkness"}]},{name:"06. Living World S1",maps:[{fileName:"520479.data",name:"Southsun Cove"},{fileName:"679089.data",name:"Tower of Nightmares"}]},{name:"07. Living World S2",maps:[{fileName:"836211.data",name:"Dry top (0)"},{fileName:"861770.data",name:"Dry top (1)"},{fileName:"909361.data",name:"The Silverwastes (0)"},{fileName:"996202.data",name:"The Silverwastes (1)"},{fileName:"908730.data",name:"Glint's Lair"}]},{name:"08. Heart of Maguuma",maps:[{fileName:"969663.data",name:"Verdant Brink"},{fileName:"1262460.data",name:"Hearts and Minds"},{fileName:"969964.data",name:"Unknown Airship in tree"},{fileName:"1262310.data",name:"Dragon Stand"},{fileName:"1263739.data",name:"Tarir"},{fileName:"1264291.data",name:"Tangled Depths"}]},{name:"09. Living World S3",maps:[{fileName:"1472635.data",name:"(E1) Bloodstone Fen"},{fileName:"1498071.data",name:"(E2) Taimi Simulator"},{fileName:"1498578.data",name:"(E2) Ring of Fire"},{fileName:"1605211.data",name:"(E3) Bitterfrost Frontier"},{fileName:"1645474.data",name:"(E4) Caudecus Manor"},{fileName:"1646520.data",name:"(E4) Lake Doric"},{fileName:"1682493.data",name:"(E5) Draconis Mons"},{fileName:"1682763.data",name:"(E5) Titan's Throat"},{fileName:"1734839.data",name:"(E6) White Mantle Fortress"},{fileName:"1735346.data",name:"(E6) Siren's Landing"},{fileName:"1735440.data",name:"(E6) Shining Blade Headquarters"}]},{name:"10. Crystal Desert",maps:[{fileName:"1794574.data",name:"Crystal Oasis"},{fileName:"1833034.data",name:"Desert Highlands"},{fileName:"1833726.data",name:"PoF story instances"},{fileName:"1839188.data",name:"Domain of Vabbi"},{fileName:"1840103.data",name:"Elon Riverlands"},{fileName:"1840368.data",name:"Kormir Sanctuary"},{fileName:"1842533.data",name:"The Desolation"}]},{name:"11. Living World S4",maps:[{fileName:"1901428.data",name:"(E1) Fahranur"},{fileName:"1902235.data",name:"(E1) Istan"},{fileName:"1903523.data",name:"(E1) Crystal Oasis"},{fileName:"1954984.data",name:"(E2) Desert Highlands"},{fileName:"1955224.data",name:"(E2) Inquest Lab Tower"},{fileName:"1955471.data",name:"(E2) Rata Primus"},{fileName:"1955642.data",name:"(E2) Divinity's Reach"},{fileName:"1955915.data",name:"(E2) Mount Maelstrom"},{fileName:"1956140.data",name:"(E2) Frostgorge Sound"},{fileName:"1956245.data",name:"(E2) Void"},{fileName:"1956299.data",name:"(E2) Hided Inquest Lab"},{fileName:"1957526.data",name:"(E2) Sandswept Isles"}]},{name:"12. Seasonal Activities",maps:[{fileName:"506592.data",name:"Ascent to Madness"},{fileName:"506670.data",name:"Mad King's Labyrinth (Past)"},{fileName:"662436.data",name:"Mad King's Labyrinth (Present)"},{fileName:"506739.data",name:"Mad King's Clock Tower"},{fileName:"622681.data",name:"The Crown Pavilion"},{fileName:"569756.data",name:"SAB Hub (0)"},{fileName:"636133.data",name:"SAB Hub (1)"},{fileName:"635555.data",name:"SAB World 1"},{fileName:"635960.data",name:"SAB World 2"},{fileName:"606255.data",name:"Zephyr Sanctum"},{fileName:"529896.data",name:"Tixx's Infinirarium"},{fileName:"529945.data",name:"Winter Wonderland"}]},{name:"13. Activites",maps:[{fileName:"605983.data",name:"Sanctum Sprint"},{fileName:"606030.data",name:"Basket Brawl"}]},{name:"14. Dungeons",maps:[{fileName:"126840.data",name:"Ascalonian Catacombs (0)"},{fileName:"189364.data",name:"Ascalonian Catacombs (1)"},{fileName:"275474.data",name:"Sorrow's Embrace"},{fileName:"276520.data",name:"Honor of the Waves"},{fileName:"284039.data",name:"Citadel of Flame"},{fileName:"287214.data",name:"Caudecus's Manor"},{fileName:"291284.data",name:"Twilight Arbor (0)"},{fileName:"645968.data",name:"Twilight Arbor (1)"},{fileName:"293606.data",name:"Crucible of Eternity"},{fileName:"473930.data",name:"The Ruined City of Arah"},{fileName:"473765.data",name:"Arah - Story"},{fileName:"580061.data",name:"Molten Facility"},{fileName:"595722.data",name:"Aetherblade Retreat"}]},{name:"15. Fractals",maps:[{fileName:"519839.data",name:"Fractals of the Mists"},{fileName:"697450.data",name:"Thaumanova Reactor"},{fileName:"1426653.data",name:"Cliffside Fractal"},{fileName:"1472361.data",name:"Chaos Isle Fractal"},{fileName:"1472382.data",name:"Snowblind Fractal"},{fileName:"1472406.data",name:"Swampland Fractal"},{fileName:"1498016.data",name:"Mistlock Observatory"},{fileName:"1498798.data",name:"Aetherblade/Mai Trin Fractal"},{fileName:"1605344.data",name:"Nightmare Fractal"},{fileName:"1733857.data",name:"Shattered Observatory Fractal"},{fileName:"1733961.data",name:"Mistlock Sanctuary"},{fileName:"1905739.data",name:"Molten Boss Fractal"},{fileName:"1905889.data",name:"Twilight Oasis Fractal"}]},{name:"16. Raid",maps:[{fileName:"1151420.data",name:"(W1) Spirit Vale"},{fileName:"1383309.data",name:"(W2) Salvation Pass"},{fileName:"1427048.data",name:"Special Forces Training Area"},{fileName:"1454070.data",name:"(W3) Stronghold of the Faithful"},{fileName:"1645215.data",name:"(W4) Bastion of the Penitent"},{fileName:"1906329.data",name:"(W5) Hall of Chains"}]},{name:"17. Structured PvP",maps:[{fileName:"871093.data",name:"Original Stronghold"},{fileName:"870987.data",name:"Battle of Champion's Dusk (0)"},{fileName:"1666233.data",name:"Battle of Champion's Dusk (1)"},{fileName:"132570.data",name:"Heart of the Mists (0)"},{fileName:"197249.data",name:"Heart of the Mists (1)"},{fileName:"1734729.data",name:"Heart of the Mists (2)"},{fileName:"1712986.data",name:"Hall of the Mists"},{fileName:"132710.data",name:"The Battle of Khylo (0)"},{fileName:"197402.data",name:"The Battle of Khylo (1)"},{fileName:"132837.data",name:"Forest of Niflhel (0)"},{fileName:"197545.data",name:"Forest of Niflhel (1)"},{fileName:"376916.data",name:"Legacy of the Foefire"},{fileName:"467374.data",name:"Raid on the Capricorn"},{fileName:"520609.data",name:"Temple of the Silent Storm"},{fileName:"579383.data",name:"Skyhammer (0)"},{fileName:"677968.data",name:"Skyhammer (1)"},{fileName:"1934470.data",name:"Skyhammer (2)"},{fileName:"791564.data",name:"Courtyard (0)"},{fileName:"1713054.data",name:"Courtyard (1)"},{fileName:"556199.data",name:"Spirit Watch (0)"},{fileName:"1473061.data",name:"Spirit Watch (1)"},{fileName:"506539.data",name:"Reaper's Rumble"},{fileName:"529718.data",name:"Snowball Mayhem"},{fileName:"595582.data",name:"Dragon Ball Arena"},{fileName:"617120.data",name:"Aspect Arena"},{fileName:"1644624.data",name:"Revenge of the Capricorn"},{fileName:"1704155.data",name:"Eternal Coliseum"}]},{name:"18. World vs World",maps:[{fileName:"131235.data",name:"Eternal Battlegrounds (0)"},{fileName:"195806.data",name:"Eternal Battlegrounds (1)"},{fileName:"1885693.data",name:"Eternal Battlegrounds (2)"},{fileName:"1918037.data",name:"Eternal Battlegrounds (3)"},{fileName:"131574.data",name:"Alpine Borderlands (0)"},{fileName:"641501.data",name:"Alpine Borderlands (1)"},{fileName:"1799855.data",name:"Alpine Borderlands (2)"},{fileName:"1647236.data",name:"Desert Borderlands (0)"},{fileName:"1799442.data",name:"Desert Borderlands (1)"},{fileName:"736241.data",name:"Edge of the Mists"}]},{name:"19. Guild Halls",maps:[{fileName:"1255378.data",name:"Gilded Hollow"},{fileName:"1256064.data",name:"Lost Precipice"},{fileName:"1843274.data",name:"Windswept Haven"}]},{name:"20. Concept and not released",maps:[{fileName:"122695.data",name:"Empty Plane"},{fileName:"184799.data",name:"Empty Plane v1"},{fileName:"197562.data",name:"Empty Plane v2"},{fileName:"875614.data",name:"Unknown Mists Platforms"},{fileName:"132853.data",name:"Empty Box"},{fileName:"1255516.data",name:"Guild Coliseum"},{fileName:"1498193.data",name:"Concept sPVP Map 1"},{fileName:"1513556.data",name:"Concept sPVP Map 2"},{fileName:"1513607.data",name:"Concept sPVP Map 3"},{fileName:"1513620.data",name:"Concept sPVP Map 4"},{fileName:"1513675.data",name:"Concept sPVP Map 5"},{fileName:"1712945.data",name:"Concept sPVP Map 6"}]}]}},{}],8:[function(e,a,t){(function(t){var r=e("./LocalReader/LocalReader"),n={t3dtoolsWorker:"modules/t3dtools/t3dworker.js",concurrentTasks:"undefined"!=typeof navigator?navigator.hardwareConcurrency:1};let i;var o;i=a.exports={version:"1.2.0",GW2File:e("./format/file/GW2File"),GW2Chunk:e("./format/file/GW2Chunk"),DataRenderer:e("./dataRenderer/DataRenderer"),EnvironmentRenderer:e("./dataRenderer/EnvironmentRenderer"),HavokRenderer:e("./dataRenderer/HavokRenderer"),PropertiesRenderer:e("./dataRenderer/PropertiesRenderer"),SingleModelRenderer:e("./dataRenderer/SingleModelRenderer"),TerrainRenderer:e("./dataRenderer/TerrainRenderer"),ZoneRenderer:e("./dataRenderer/ZoneRenderer"),StringRenderer:e("./dataRenderer/StringRenderer"),Logger:e("./Logger"),MapFileList:e("./MapFileList"),MaterialUtils:e("./util/MaterialUtils.js"),MathUtils:e("./util/MathUtils.js"),ParserUtils:e("./util/ParserUtils.js"),RenderUtils:e("./util/RenderUtils.js"),PersistantStore:e("./LocalReader/PersistantStore"),FileTypes:e("./LocalReader/FileTypes"),getLocalReader:function(e,a,t){var i=new r({workerPath:t||n.t3dtoolsWorker,workersNb:n.concurrentTasks});return i.openArchive(e).then(()=>{a(i)}),i},getFileListAsync:function(e,a){e.readFileList().then(e=>{let t={};for(let a of e)void 0===t[a.fileType]&&(t[a.fileType]=[]),t[a.fileType].push(a.mftId);a(t)})},getMapListAsync:function(e,a,t){function r(e){let a=[];for(let t of e){let e=a.findIndex(e=>e.name==t.category);-1==e&&(e=a.push({name:t.category,maps:[]})-1),a[e].maps.push({fileName:t.baseId,name:t.name})}return a.sort((e,a)=>e.name<a.name?-1:e.name>a.name?1:0),{maps:a}}t?e.readFileList().then(()=>{a(r(e.getMapList()))}):a(r(e.getMapList()))},renderMapContentsAsync:function(e,a,t,r,n){var o={};parseInt(a)?e.readFile(parseInt(a),!1,!1,void 0,void 0,!0).then(a=>{let n=a.buffer;var s=new DataStream(n,0,DataStream.LITTLE_ENDIAN),l=new i.GW2File(s,0),d=function(a){a<t.length?i.runRenderer(t[a].renderClass,e,Object.assign(t[a].settings,{mapFile:l}),o,d.bind(this,a+1)):r(o)};d(0)}):(n||i.Logger).log(i.Logger.TYPE_ERROR,"Map id must be an integer!, was:",a)},runRenderer:function(e,a,t,r,n){new e(a,t,r).renderAsync(n)},getContextValue:function(e,a,t,r){var n=e[a.name];return n&&n[t]?n[t]:r},hasWebGL:function(e){if(window.WebGLRenderingContext){for(var a=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],r=!1,n=0;n<4;n++)try{if((r=a.getContext(t[n]))&&"function"==typeof r.getParameter)return!e||{name:t[n],gl:r}}catch(e){}return!1}return!1}},o=0,t.window&&window.indexedDB||(i.Logger.log(i.Logger.TYPE_ERROR,"T3D persistant storing and loading requires indexedDB support."),o++),"undefined"==typeof DataStream&&(i.Logger.log(i.Logger.TYPE_ERROR,"T3D core functionality requires DataStream library."),o++),"undefined"==typeof THREE&&(i.Logger.log(i.Logger.TYPE_WARNING,"T3D mesh generation requires three.js library."),o++),o<1&&i.Logger.log(i.Logger.TYPE_MESSAGE,"Tyria 3D API v"+i.version+" initialized.")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./LocalReader/FileTypes":3,"./LocalReader/LocalReader":4,"./LocalReader/PersistantStore":5,"./Logger":6,"./MapFileList":7,"./dataRenderer/DataRenderer":9,"./dataRenderer/EnvironmentRenderer":10,"./dataRenderer/HavokRenderer":11,"./dataRenderer/PropertiesRenderer":12,"./dataRenderer/SingleModelRenderer":13,"./dataRenderer/StringRenderer":14,"./dataRenderer/TerrainRenderer":15,"./dataRenderer/ZoneRenderer":16,"./format/file/GW2Chunk":17,"./format/file/GW2File":18,"./util/MaterialUtils.js":22,"./util/MathUtils.js":23,"./util/ParserUtils.js":25,"./util/RenderUtils.js":26}],9:[function(e,a,t){const r=e("../format/file/GW2File");a.exports=class DataRenderer{constructor(e,a,t,r){this.localReader=e,this.settings=a,a||(a={}),this.context=t,this.context[this.constructor.name]={},this.logger=r||T3D.Logger}getOutput(e){return this.context[e?e.name:this.constructor.name]}renderAsync(e){this.localReader.readFile(this.settings.id,!1,!1,void 0,void 0,!0).then(a=>{let t=a.buffer;this.getOutput().fileId=this.settings.id,this.getOutput().rawData=t;var n=new Uint8Array(t);let i=new TextDecoder("latin2");this.getOutput().rawString=i.decode(n);var o=new DataStream(t),s=o.readCString(4);"ATEX"==s||"ATEC"==s||"ATEP"==s||"ATET"==s||"ATEU"==s||"ATTX"==s?this.localReader.readFile(this.settings.id,!0,!1,void 0,void 0,!0).then(a=>{var t={data:new Uint8Array(a.buffer),width:a.imageWidth,height:a.imageHeight};this.getOutput().image=t,e()}):0==s.indexOf("PF")?(this.getOutput().file=new r(o,0),e()):(this.getOutput().file=null,e())})}}},{"../format/file/GW2File":18}],10:[function(e,a,t){const r=e("../util/MapEnvUtils"),n=e("./DataRenderer");a.exports=class EnvironmentRenderer extends n{constructor(e,a,t,r){super(e,a,t,r),this.mapFile=this.settings.mapFile}renderAsync(e){var a=this.mapFile.getChunk("env").data,t=this.mapFile.getChunk("parm").data,n=r.getHazeColor(a),i=256*n[2]*256+256*n[1]+n[0];this.getOutput().hazeColor=n;let o=r.parseLights(a);this.getOutput().hasLight=o.hasLight,this.getOutput().lights=o.lights,this.getOutput().skyElements=r.parseSkybox(a,t,i,["img/193068.png","img/193070.png","img/193072.png"],this.localReader).skyElements,e()}}},{"../util/MapEnvUtils":20,"./DataRenderer":9}],11:[function(e,a,t){const r=e("./DataRenderer");a.exports=class HavokRenderer extends r{constructor(e,a,t,r){super(e,a,t,r),this.mapFile=this.settings.mapFile,this.lastP=-1,this.seed=1,this.meshes=[],this.renderModels=function(e,a,t){var r;r=this.settings&&this.settings.visible?new THREE.MeshNormalMaterial({side:THREE.DoubleSide}):new THREE.MeshBasicMaterial({visible:!1}),this.parseAllModels(e,r,a,200,0,t)},this.getCollisionsForAnimation=function(e,a){for(var t=[],r=0;r<e.collisionIndices.length;r++){var n=e.collisionIndices[r],i=a[n];i.index=n,t.push(i)}return t},this.parseAllModels=function(e,a,t,r,n,i){for(var o=n;o<n+r&&o<e.length;o++){var s=Math.round(100*o/e.length);s!=this.lastP&&(this.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Collision Models ("+t+")",s),this.lastP=s);for(var l=this.animationFromGeomIndex(e[o].geometryIndex,this.geometries,this.animations),d=this.getCollisionsForAnimation(l,this.havokChunkData.collisions),m=0;m<d.length;m++){var f=d[m];this.renderMesh(f,e[o],a)}}o<e.length?window.setTimeout(this.parseAllModels.bind(this,e,a,t,r,n+r,i),10):i()},this.animationFromGeomIndex=function(e,a,t){var r=a[e].animations.length;return t[a[e].animations[r-1]]},this.renderMesh=function(e,a,t){var r=a.translate,n=a.rotate,i=32*a.scale,o=this.parseHavokMesh(e,t);o.position.set(r[0],-r[2],-r[1]),i&&o.scale.set(i,i,i),n&&(o.rotation.order="ZXY",o.rotation.set(n[0],-n[2],-n[1])),this.getOutput().meshes.push(o)},this.seedRandom=function(){var e=1e4*Math.sin(this.seed++);return e-Math.floor(e)},this.parseHavokMesh=function(e,a){var t=e.index;if(this.meshes[t])return this.meshes[t].clone();for(var r=new THREE.Geometry,n=0;n<e.vertices.length;n++){var i=e.vertices[n];r.vertices.push(new THREE.Vector3(i[0],i[2],-i[1]))}for(n=0;n<e.indices.length;n+=3){var o=e.indices[n],s=e.indices[n+1],l=e.indices[n+2];o<=e.vertices.length&&s<=e.vertices.length&&l<=e.vertices.length?r.faces.push(new THREE.Face3(o,s,l)):this.logger.log(T3D.Logger.TYPE_ERROR,"Errorus index in havok model geometry.")}return r.computeFaceNormals(),this.meshes[t]=new THREE.Mesh(r,a),this.meshes[t]}}renderAsync(e){var a=this;this.havokChunkData=this.mapFile.getChunk("havk").data,this.getOutput().boundingBox=this.havokChunkData.boundsMax,this.meshes=[],this.getOutput().meshes=[];var t=this.havokChunkData.propModels,r=this.havokChunkData.zoneModels,n=this.havokChunkData.obsModels;n.forEach(function(e){e.scale=1}),this.geometries=this.havokChunkData.geometries,this.animations=this.havokChunkData.animations;var i=function(){a.renderModels(n,"obs",e)};a.renderModels(t,"prop",function(){a.renderModels(r,"zone",i)})}}},{"./DataRenderer":9}],12:[function(e,a,t){const r=e("../util/ModelUtils"),n=e("./DataRenderer");a.exports=class PropertiesRenderer extends n{constructor(e,a,t,r){super(e,a,t,r),this.mapFile=this.settings.mapFile}renderAsync(e){var a=this;a.getOutput().meshes=[];var t=this.mapFile.getChunk("prp2").data;if(t){var n=t.propArray,i=t.propAnimArray,o=t.propInstanceArray,s=t.propMetaArray;n=n.concat(i).concat(o).concat(s),a.meshCache={},a.textureCache={};var l=-1,d=function(t){if(t>=n.length)return a.meshCache={},a.textureCache={},void e();var i=Math.round(1e3*t/n.length);if(l!=(i/=10)){var o=i+(i.toString().indexOf(".")<0?".0":"");a.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Props)",o),l=i}var s=n[t],m=function(e,a,t,r,n){var i=0!=r.lod2?r.lod2:e.lodOverride[1];if(0==e.flags&&(i=0),n&&(e=new THREE.Mesh(e.geometry,e.material)),e.updateMatrix(),e.matrixAutoUpdate=!1,a[i])a[i].add(e);else{var o=new THREE.Group;o.updateMatrix(),o.matrixAutoUpdate=!1,o.add(e),a[i]=o,t.addLevel(o,i)}return i};r.getMeshesForFilename(s.filename,s.color,a.localReader,a.meshCache,a.textureCache,!1,!1,function(e,r,n){e&&function(e,t,r){var n={},i=new THREE.LOD,o=0;e.forEach(function(e){o=Math.max(o,m(e,n,i,s,t))}),i.addLevel(new THREE.Group,1e5),s.rotation&&(i.rotation.order="ZXY",i.rotation.set(s.rotation[0],-s.rotation[2],-s.rotation[1])),i.scale.set(s.scale,s.scale,s.scale),i.position.set(s.position[0],-s.position[2],-s.position[1]),i.boundingSphereRadius=(r&&r.radius?r.radius:1)*s.scale,i.updateMatrix(),i.matrixAutoUpdate=!1,a.getOutput().meshes.push(i),s.transforms&&s.transforms.forEach(function(t){var n={},i=new THREE.LOD,o=0;e.forEach(function(e){o=Math.max(o,m(e,n,i,s,!0))}),t.rotation&&(i.rotation.order="ZXY",i.rotation.set(t.rotation[0],-t.rotation[2],-t.rotation[1])),i.scale.set(t.scale,t.scale,t.scale),i.position.set(t.position[0],-t.position[2],-t.position[1]),i.updateMatrix(),i.matrixAutoUpdate=!1,i.boundingSphereRadius=(r&&r.radius?r.radius:1)*s.scale,i.update(i),a.getOutput().meshes.push(i)})}(e,r,n),d(t+1)})};d(0)}else renderCallback()}getFileIdsAsync(e){var a=[],t=this.mapFile.getChunk("prp2").data,r=t.propArray,n=t.propAnimArray,i=t.propInstanceArray,o=t.propMetaArray;r=r.concat(n).concat(i).concat(o);var s=function(t){if(t>=r.length)e(a);else{t%100==0&&this.logger.log(T3D.Logger.TYPE_MESSAGE,"getting ids for entry",t,"of",r.length);var n=r[t];Utils.getFilesUsedByModel(n.filename,localReader,function(e){a=a.concat(e),s(t+1)})}};s(0)}}},{"../util/ModelUtils":24,"./DataRenderer":9}],13:[function(e,a,t){const r=e("../util/ModelUtils"),n=e("./DataRenderer");a.exports=class SingleModelRenderer extends n{constructor(e,a,t,r){super(e,a,t,r)}renderAsync(e){var a=this,t=this.settings.id,n={};a.getOutput().meshes=[],r.getMeshesForFilename(t,65280,a.localReader,n,{},!0,!0,function(t,r,i){t&&t.forEach(function(e){e.boundingSphere=i,a.getOutput().meshes.push(e)}),n={},e()})}}},{"../util/ModelUtils":24,"./DataRenderer":9}],14:[function(e,a,t){const r=e("./DataRenderer");a.exports=class StringRenderer extends r{constructor(e,a,t,r){super(e,a,t,r)}renderAsync(e){var a=this;this.settings.id,this.getOutput().strings=[],this.localReader.readFile(this.settings.id,!1,!1,void 0,void 0,!0).then(t=>{let r=t.buffer;var n=new DataStream(r),i=n.byteLength-2;n.seek(4);for(var o=["size","uint16","decryptionOffset","uint16","bitsPerSymbol","uint16"],s=0;i-n.position>6;){var l=n.readStruct(o);if(l.size-=6,l.size>0&&0==l.decryptionOffset&&16==l.bitsPerSymbol){var d=n.readUCS2String(l.size/2);a.getOutput().strings.push({value:d,recid:s})}s++}n.seek(n.byteLength-2),a.getOutput().language=n.readUint16(),e()})}}},{"./DataRenderer":9}],15:[function(e,a,t){const r=e("./DataRenderer"),n=e("../util/MapTerrainUtils");a.exports=class TerrainRenderer extends r{constructor(e,a,t,r){super(e,a,t,r),this.mapFile=this.settings.mapFile}renderAsync(e){var a=this.mapFile.getChunk("trn").data.materials.pagedImage;this.localReader.readFile(a,!1,!1,void 0,void 0,!0).then(e=>n.loadPagedImageCallback(e.buffer,this.mapFile,this.settings.anisotropy,this.getOutput(T3D.EnvironmentRenderer),this.localReader)).then(a=>{this.getOutput().terrainTiles=a.terrainTiles,this.getOutput().water=a.water,this.getOutput().bounds=a.mapRect,e()})}getFileIdsAsync(e){e(n.getTerrainFilesId(this.mapFile))}}},{"../util/MapTerrainUtils":21,"./DataRenderer":9}],16:[function(e,a,t){const r=e("../util/ModelUtils"),n=e("./DataRenderer");a.exports=class ZoneRenderer extends n{constructor(e,a,t,n){super(e,a,t,n),this.mapFile=this.settings.mapFile,this.renderZone=function(e,a,t,n){var i=this,o=null;a.forEach(function(a){o||a.token!=e.defToken||(o=a)});var s=this.getModelGroups(e,o,t);i.meshCache={},i.textureCache={};var l=Object.keys(s);!function e(a){if(a>=l.length)return i.meshCache={},i.textureCache={},void n();var t=l[a],o=s[t],d=[];r.getMeshesForFilename(t,null,i.localReader,i.meshCache,i.textureCache,!1,!1,function(t,r){t&&o.forEach(function(e,a){t.forEach(function(t,r){if(525!=t.materialFlags){var n={x:0,y:0,z:0};if(d[r])n.x=e.x-d[r].position.x,n.y=e.z-d[r].position.z,n.z=e.y-d[r].position.y;else{var i=t.geometry.clone();d[r]={readVerts:i.getAttribute("position").array,verts:new Float32Array(o.length*i.getAttribute("position").array.length),readIndices:i.getIndex().array,indices:new Uint32Array(o.length*i.getIndex().array.length),readUVs:i.getAttribute("uv").array,uvs:new Float32Array(o.length*i.getAttribute("uv").array.length),readNormals:i.getAttribute("normal").array,normals:new Float32Array(o.length*i.getAttribute("normal").array.length),material:t.material,position:{x:e.x,y:e.y,z:e.z}}}for(var s=d[r].readVerts,l=d[r].verts,m=s.length,f=0,h=a*m;f<m;f+=3,h+=3)l[h+0]=s[f+0]+n.x,l[h+1]=s[f+1]+n.y,l[h+2]=s[f+2]+n.z;var u=d[r].readIndices,c=d[r].indices,g=u.length,p=m*a/3;for(f=0,h=a*g;f<g;f++,h++)c[h]=u[f]+p;var v=d[r].readUVs,T=d[r].uvs,E=v.length;for(f=0,h=a*E;f<E;f++,h++)T[h]=v[f];var R=d[r].readNormals,y=d[r].normals,N=R.length;for(f=0,h=a*N;f<N;f++,h++)y[h]=R[f]}})}),d.forEach(function(e){var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(e.verts,3)),a.setIndex(new THREE.BufferAttribute(e.indices,1)),a.addAttribute("normal",new THREE.BufferAttribute(e.normals,3)),a.addAttribute("uv",new THREE.BufferAttribute(e.uvs,2)),a.buffersNeedUpdate=!0;let t=new THREE.Mesh(a,e.material);t.position.set(e.position.x,e.position.z,e.position.y),i.getOutput().meshes.push(t)}),e(a+1)})}(0)},this.getModelGroups=function(e,a,t){e.zPos;var r=t[0],n=t[1],i=48,o=e.vertRect[0]*i+r,s=(e.vertRect[2],e.vertRect[1]*-i-n);if(e.vertRect[3],0==e.encodeData.length)return{};for(var l=e.vertRect[0]-e.vertRect[2],d=(e.vertRect[1],e.vertRect[3],0),m={},f=this.getOutput(T3D.TerrainRenderer).terrainTiles,h=0;h<e.flags.length;h+=2){d+=e.flags[h];var u=e.flags[h+1];if(0!=u){var c=u>>4,g=a.layerDefArray[c-1];if(g){var p=d%l*i+o,v=Math.floor(d/l)*i+s,T=null,E=new THREE.Raycaster(new THREE.Vector3(p,1e5,v),new THREE.Vector3(0,-1,0));f.forEach(function(e){if(null===T){var a=E.intersectObject(e);a.length>0&&(T=1e5-a[0].distance)}});var R=g.modelArray[0],y=R.filename,N=(R.zOffsets,g.layerFlags,g.rotRangeX),x=g.rotRangeY,M=g.rotRangeZ,k=g.scaleRange,w=g.fadeRange;m[y]||(m[y]=[]),m[y].push({x:p,y:v,z:T,rotRangeX:N,rotRangeY:x,rotRangeZ:M,scaleRange:k,fadeRange:w})}}}return m}}renderAsync(e){var a=this;a.getOutput().meshes=[];var t=this.mapFile.getChunk("zon2").data,r=this.mapFile.getChunk("parm").data,n=(this.mapFile.getChunk("trn").data,r.rect),i=t.zoneArray,o=t.zoneDefArray;let s=-1;!function t(r){var l=Math.round(100*r/i.length);s!=l&&(a.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Zone)",l),s=l),r>=i.length?e():a.renderZone(i[r],o,n,t.bind(a,r+1))}(0)}}},{"../util/ModelUtils":24,"./DataRenderer":9}],17:[function(e,a,t){const r=["type","cstring:4","chunkDataSize","uint32","chunkVersion","uint16","chunkHeaderSize","uint16","offsetTableOffset","uint32"];var n;const i=[{pack:"MODL",chunk:"ANIM",root:"ModelFileAnimation"},{pack:"MODL",chunk:"GAME",root:"ModelFileGame"},{pack:"MODL",chunk:"SKEL",root:"ModelFileSkeleton"},{pack:"MODL",chunk:"TOOL",root:"ModelFileTool"},{pack:"cntc",chunk:"Main",root:"PackContent"},{pack:"mMet",chunk:"Main",root:"PackMapMetadata"},{pack:"AMAT",chunk:"TOOL",root:"AmatToolParams"},{pack:"cmaC",chunk:"main",root:"CollideModelManifest"}];class GW2Chunk{constructor(e,a){!function(){if(!n){n={};for(let a of i){let t=new RegExp(`^${a.root}(V[0-9]*)?$`),r=T3D.formats.filter(e=>e.name==a.chunk);for(let i in r){let o=r[i].versions;if(e(o[Object.keys(o).pop()]).match(t)){n[a.chunk]||(n[a.chunk]=[]),n[a.chunk][i]=a.pack;break}}}}function e(e){let a=new e;return Object.keys(a).filter(e=>a[e]===a.__root&&"__root"!=e)[0]}}(),this.ds=e,this.addr=a,this.data=null,this.headerLength=NaN,this.loadHead()}loadHead(){this.ds.seek(this.addr),this.header=this.ds.readStruct(r),this.headerLength=this.ds.position-this.addr}getDefinition(e){var a=0,t=n[this.header.type];if(t){a=-1;for(var r=0;r<t.length&&-1==a;r++){t[r]==e&&(a=r)}}var i=0;for(r=0;r<T3D.formats.length;r++){var o=T3D.formats[r];if(o.name==this.header.type){if(i==a&&o.versions[this.header.chunkVersion])return(new o.versions[this.header.chunkVersion]).__root;i++}}}loadData(e){var a=this.getDefinition(e);a?(this.ds.seek(this.addr+this.headerLength),this.data=this.ds.readStruct(a)):T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Could not find a definition for chunk",this.header.type,"version",this.header.chunkVersion,"file name",e)}next(){try{return new GW2Chunk(this.ds,this.addr+8+this.header.chunkDataSize)}catch(e){}return null}}a.exports=GW2Chunk},{}],18:[function(e,a,t){const r=e("./GW2Chunk"),n=["identifier","cstring:2","unknownField1","uint16","unknownField2","uint16","pkFileVersion","uint16","type","cstring:4"];a.exports=class GW2File{constructor(e,a,t){this.ds=e,this.addr=a,this.data=null,this.headerLength=NaN,this.chunks=[],this.readHead(),t||this.readChunks()}readHead(){this.ds.seek(this.addr),this.header=this.ds.readStruct(n),this.headerLength=this.ds.position-this.addr}readChunks(){this.chunks=[];for(var e=new r(this.ds,this.headerLength+this.addr);null!=e&&e.header.type;)e.loadData(this.header.type),this.chunks.push(e),e=e.next()}getChunk(e){for(var a=0;a<this.chunks.length;a++)if(this.chunks[a].header.type.toLowerCase()==e.toLowerCase())return this.chunks[a];return null}getChunkStructs(){return{}}}},{"./GW2Chunk":17}],19:[function(e,a,t){a.exports={fvfFormat:{Position:1,Weights:2,Group:4,Normal:8,Color:16,Tangent:32,Bitangent:64,TangentFrame:128,UV32Mask:65280,UV16Mask:16711680,Unknown1:16777216,Unknown2:33554432,Unknown3:67108864,Unknown4:134217728,PositionCompressed:268435456,Unknown5:536870912}}},{}],20:[function(e,a,t){const r=e("./MaterialUtils");function n(e){return new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide,fog:!1,depthWrite:!1})}function i(e,a,t,i,o,s){function l(t){for(let r of e)a[r]=t}function d(){l(n((new THREE.TextureLoader).load(i)))}l(n(r.loadLocalTexture(s,t,null,o,function(){setTimeout(d,1)})))}a.exports={getHazeColor:function(e){let a=e&&e.dataGlobal.haze;return!a||a.length<=0?[190,160,60]:a[0].farColor},parseLights:function(e){let a,t=[],r=e?e.dataGlobal.lighting:[{lights:[],backlightIntensity:1,backlightColor:[255,255,255]}],n=!1;for(let e in r){let i=r[e];if(n)break;let o=0;for(let e of i.lights){n=!0;let a=new THREE.Color(e.color[2]/255,e.color[1]/255,e.color[0]/255),r=new THREE.DirectionalLight(a.getHex(),e.intensity);r.position.set(-e.direction[0],e.direction[2],e.direction[1]).normalize(),o+=e.intensity,t.push(r)}if(!i.lights||0==i.lights.length){const e=[[0,1,0,.3],[1,2,1,.3],[-1,-2,-1,.3]];for(let a of e){const e=new THREE.Color(1,1,1);let r=a[3],n=new THREE.DirectionalLight(e.getHex(),r);n.position.set(a[0],a[1],a[2]).normalize(),o+=r,t.push(n)}}i.backlightIntensity=i.backlightIntensity;const s=new THREE.Color(i.backlightIntensity*(255-i.backlightColor[2])/255,i.backlightIntensity*(255-i.backlightColor[1])/255,i.backlightIntensity*(255-i.backlightColor[0])/255);a=new THREE.AmbientLight(s)}let i=0;return a&&(i=a.color.r+a.color.g+a.color.b,t.push(a)),{lights:t,hasLight:n||i>0}},parseSkybox:function(e,a,t,r,n){let o=[],s=this.environmentChunkData&&this.environmentChunkData.dataGlobal.skyModeTex[0];s||(s={texPathNE:1930687,texPathSW:193069,texPathT:193071});const l=a.rect;let d=Math.abs(l.x1-l.x2),m=Math.abs(l.y1-l.y2),f=(Math.max(d,m),[]);i([1,4],f,s.texPathNE+1,r[0],t,n),i([0,5],f,s.texPathSW+1,r[1],t,n),i([2],f,s.texPathT+1,r[2],t,n),f[3]=new THREE.MeshBasicMaterial({visible:!1});let h=new THREE.BoxGeometry(1024,512,1024);for(let e in h.faceVertexUvs[0]){let a=h.faceVertexUvs[0][e],t=Math.floor(e/2);if(0==t||1==t)for(let e of a)e.x=1-e.x,e.y/=2,e.y+=.5;else if(5==t||4==t)for(let e of a)e.y/=-2,e.y+=.5;else for(let e of a)e.x=1-e.x}h.uvsNeedUpdate=!0;var u=new THREE.Mesh(h,f);return u.translateY(256),o.push(u),{skyElements:o}}}},{"./MaterialUtils":22}],21:[function(e,a,t){const r=e("./RenderUtils"),n=e("./MaterialUtils"),i=e("./TerrainShader"),o=e("../format/file/GW2File");a.exports={loadPagedImageCallback:async function(e,a,t,s,l){let d=[];var m=new DataStream(e),f=new o(m,0).getChunk("pgtb"),h=f&&f.data;let u=null;var c=a.getChunk("trn").data,g=a.getChunk("parm").data,p=t||1;!function(e){e.numChunksD_1=Math.sqrt(e.dims[0]*e.chunkArray.length/e.dims[1]),e.numChunksD_2=e.chunkArray.length/e.numChunksD_1}(c);var v=c.numChunksD_1,T=c.numChunksD_2,E=c.materials.materials,R=c.materials.texFileArray,y=g.rect[2]-g.rect[0],N=g.rect[3]-g.rect[1],x=y/c.numChunksD_1*1,M=N/c.numChunksD_2*1,k=0,w=[],b=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:6710886,flatShading:!0}),F={};h&&h.strippedPages.forEach(function(e){if(e.layer<=1){var a=e.filename,t=(e.solidColor,e.coord),r=t[0]+","+t[1];if(1==e.layer&&(r+="-2"),!F[r]){var i=n.loadLocalTexture(l,a);i&&(i.anisotropy=p,i.wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping),F[r]=i}}});var D=function(e,a){for(var t,r=a*v+e,o=Math.floor(e/4),m=Math.floor(a/4),f=E[r].loResMaterial.texIndexArray,h=(E[r].loResMaterial.materialFile,c.chunkArray[r],R[f[0]],e%4/4),T=.75-a%4/4,y=[],N=0;N<f.length/2;N++){var D=R[f[N]].filename;if(y.push(D),!F[D]){var S=n.loadLocalTexture(l,D);S&&(S.anisotropy=p,S.wrapS=THREE.RepeatWrapping,S.wrapT=THREE.RepeatWrapping),F[D]=S}}var L=o+","+m,A=o+","+m+"-2",C={color:{r:1,g:1,b:1},near:0,far:0};s.hazeColor&&(C.color.r=s.hazeColor[2]/255,C.color.g=s.hazeColor[1]/255,C.color.b=s.hazeColor[0]/255);var _=THREE.UniformsUtils.merge([THREE.UniformsLib.lights]);_.uvScale={type:"v2",value:new THREE.Vector2(8,8)},_.offset={type:"v2",value:new THREE.Vector2(h,T)},_.texturePicker={type:"t",value:F[L]},_.texturePicker2={type:"t",value:F[A]},_.texture1={type:"t",value:F[y[0]]},_.texture2={type:"t",value:F[y[1]]},_.texture3={type:"t",value:F[y[2]]},_.texture4={type:"t",value:F[y[3]]},t=new THREE.ShaderMaterial({uniforms:_,fragmentShader:i.getFragmentShader(),vertexShader:i.getVertexShader()}),w.push(t);for(var P=new THREE.PlaneBufferGeometry(x,M,32,32),U=0,H=0;H<35;H++)for(var I=0;I<35;I++)0!=I&&34!=I&&0!=H&&34!=H&&(P.getAttribute("position").array[3*U+2]=c.heightMapArray[k],U++),k++;var O,W=(new THREE.Matrix4).identity();W.elements[5]=-1,P.applyMatrix(W),P.computeFaceNormals(),O=new THREE.Mesh(P,b),(O=t.length?THREE.SceneUtils.createMultiMaterialObject(P,t):new THREE.Mesh(P,t)).rotation.set(Math.PI/2,0,0);var G=g.rect[0]+x/2,B=e*x;if(O.position.x=G+B,c.numChunksD_2%2==0){var z=g.rect[1]+M/2-0,Y=a*M*1;O.position.z=Y+z}else z=g.rect[1]-M/2+0,Y=a*M*1,O.position.z=z+Y;var V=O.position.x,j=O.position.z;u||(u={x1:V-x/2,x2:V+x/2,y1:j-M/2,y2:j+M/2}),u.x1=Math.min(u.x1,V-x/2),u.x2=Math.max(u.x2,V+x/2),u.y1=Math.min(u.y1,j-M/2),u.y2=Math.max(u.y2,j+M/2),O.updateMatrix(),O.updateMatrixWorld(),d.push(O)};let S=0,L=0;for(;L<T;){D(S,L),(S+=1)>=v&&(S=0,L++),await new Promise(e=>setTimeout(e,1));let e=Math.floor(100*(L*v+S)/(v*T));T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Terrain",e)}return{terrainTiles:d,water:(A=u,C=C||new THREE.MeshBasicMaterial({color:6009320,wireframe:!1,opacity:.35}),C.transparent=!0,r.renderRect(A,0,C)),mapRect:u};var A,C},getTerrainFilesId:function(e){var a=e.getChunk("trn"),t=e.getChunk("pimg"),r=[];return(t&&t.data).strippedPages.forEach(function(e){e.layer<=1&&e.filename>0&&r.push(e.filename)}),a.data.materials.texFileArray.forEach(function(e){e.filename>0&&r.push(e.filename)}),r}}},{"../format/file/GW2File":18,"./MaterialUtils":22,"./RenderUtils":26,"./TerrainShader":27}],22:[function(e,a,t){function r(e){for(var a="",t="",r="",n=0;n<e;n++)a+="varying vec2 vUv_"+(n+1)+";\n",n>1&&(t+="attribute vec2 uv"+(n+1)+";\n"),r+="vUv_"+(n+1)+" = uv"+(n>0?n+1:"")+";\n";return t+a+"void main()\n{\n"+r+"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"}function n(e,a,t){for(var r=e*a,n=new Uint8Array(4*r),i=Math.floor(255*t.r),o=Math.floor(255*t.g),s=Math.floor(255*t.b),l=0;l<r;l++){var d=4*l;n[d]=i,n[d+1]=o,n[d+2]=s,n[d+3]=255}return new THREE.DataTexture(n,e,a,THREE.RGBAFormat)}function i(e,a,t,r){var n="vUv_"+(e[0].uvIdx+1),i="";t&&(i="    if (c1.a < 0.5) \n       discard;\n");var o="gl_FragColor = c1;\n";if(r){o="   vec4 c2 = texture2D( texture1, vUv_1 );\n     gl_FragColor = c2;\n"}var s="";e.forEach(function(e,a){s+="uniform sampler2D texture"+(a+1)+";\n"});for(var l="",d=0;d<a;d++)l+="varying vec2 vUv_"+(d+1)+";\n";return s+l+"void main( void ) {\n    vec4 c1 = texture2D( texture1, "+n+" );\n"+i+o+"}"}function o(e,a,t){var n=!1,o={};e.forEach(function(e,a){o["texture"+a]={type:"t",value:e}}),e.length>1&&(n=!0);for(var s={},l=2;l<a;l++)s["uv"+(l+1)]={type:"v2",value:[]};var d=r(a);return new THREE.ShaderMaterial({uniforms:o,vertexShader:d,fragmentShader:i(e,a,t,n),attributes:s,side:THREE.FrontSide})}function s(e,a,t){var r;return e&&t[e]?r=t[e]:e&&((r=l(a,e)).wrapT=THREE.RepeatWrapping,r.wrapS=THREE.RepeatWrapping,r.flipY=!1,t[e]=r),r}function l(e,a,t,r,i){void 0===r&&(r=Math.floor(16777215*Math.random()));var o=n(1,1,new THREE.Color(r));return o.minFilter=THREE.LinearMipMapLinearFilter,o.magFilter=THREE.LinearFilter,o.generateMipmaps=!0,o.flipY=!0,parseInt(a)<=0?(i&&i(),o):(e.readFile(a,!0,!1,void 0,void 0,!0).then(e=>{if(e.buffer){var a={data:new Uint8Array(e.buffer),width:e.imageWidth,height:e.imageHeight};o.format=(3==e.dxtType||e.dxtType,THREE.RGBAFormat),o.image=a,o.needsUpdate=!0}else i&&i()}),o)}a.exports={buildVS:r,generateDataTexture:n,buildPS:i,getUVMat:o,getMaterial:function(e,a,t,r){if(a){var n,i=a.getChunk("dx9s"),o=a.getChunk("grmt"),l=[];if(e&&e.textures.length){for(var d=i.data.techniques[0].passes[0].effects[0],m=(i.data.shaders[d.pixelShader],[]),f=0;f<d.samplerIndex.length;f++){var h=d.samplerIndex[f],u=i.data.samplers[h];if(u){var c=u&&o.data.texTokens[u.textureIndex];c||(c="0-0");var g=null;if(e.textures.forEach(function(e,a){g||e.token.split("-")[0]!=c.split("-")[0]||(g=e)}),g)m.push(g);else if(u)m.push(e.textures[u.textureIndex]);else{if(!(e.textures.length>0))return;m.push(e.textures[0])}}}if(m.length<=0)return;m.forEach(function(e,a){if(e){var n=e&&e.filename;l[a]=s(n,t,r),l[a]&&(l[a].uvIdx=e.uvPSInputIndex)}})}if(l){var p=!1,v=!1;if(e.textures.forEach(function(e){p||"1733499172"!=e.token.split("-")[0]||(p=e),v||"404146670"!=e.token.split("-")[0]||(v=e)}),!p||p.filename<=0)return;if(n=new THREE.MeshPhongMaterial({side:THREE.FrontSide,map:s(p.filename,t,r)}),v){var T=s(v.filename,t,r);T.flipY=!0,n.normalMap=T}n.textureFilename=p.filename,16460!=o.data.flags&&(n.alphaTest=.05)}else n=new THREE.MeshBasicMaterial({side:THREE.FrontSide,color:16711680,shading:THREE.FlatShading});return n.needsUpdate=!0,e&&(o=a.getChunk("grmt"),1&e.materialFlags||16&e.materialFlags||e.materialFlags,[16460,16452,16448,8268,3392,2380,2368,332,324,320,76,68,64].indexOf(o.data.flags)<0&&T3D.Logger.log(T3D.Logger.TYPE_WARNING,"unknown GR flag",o.data.flags),8&o.data.flags||(n=new THREE.MeshBasicMaterial({side:THREE.FrontSide,map:n.map})),16460!=o.data.flags&&(n.alphaTest=.05)),n}},loadLocalTexture:l}},{}],23:[function(e,a,t){const r=Math.pow(2,32);a.exports={f16:function(e){var a=(32768&e)>>15,t=(31744&e)>>10,r=1023&e;return 0==t?(a?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==t?r?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,t-15)*(1+r/Math.pow(2,10))},popcount:function(e){return e=(252645135&(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459)))+(e>>4&252645135),(e+=e>>8)+(e>>15)&63},arr32To64:function(e){return r*e[1]+e[0]},sort_unique:function(e,a){for(var t=Array.prototype.sort.call(e,a),r={},n=[],i=0,o=t.length;i<o;++i)r.hasOwnProperty(t[i])||(n.push(t[i]),r[t[i]]=1);return n}}},{}],24:[function(e,a,t){const r=e("../format/file/GW2File"),n=e("./MaterialUtils"),i=e("./MathUtils");let o={};const s=e("./Constants").fvfFormat;function l(e,a,t,r,l){var d=a.data.meshes,m=[],f=t.data.permutations[0].materials;for(let a of d){var h=a.geometry,u=h.verts.mesh.fvf,c=h.verts.vertexCount,g=h.verts.mesh.vertices,p=h.indices.indices,v=new THREE.BufferGeometry,T=new DataStream(g.buffer),E=g.length/c,R=new Float32Array(3*c),y=[],N=12*!!(u&s.Position)+4*!!(u&s.Weights)+4*!!(u&s.Group)+12*!!(u&s.Normal)+4*!!(u&s.Color)+12*!!(u&s.Tangent)+12*!!(u&s.Bitangent)+12*!!(u&s.TangentFrame),x=(u&s.UV32Mask)>>8,M=(u&s.UV16Mask)>>16,k=!!x,w=!!M||!!x,b=k?x:M,F=i.popcount(b);if(F=Math.min(F,1),w)for(var D=0;D<F;D++)y[D]=new Float32Array(2*c);for(D=0;D<c;D++){T.seek(D*E);var S=T.readFloat32(),L=T.readFloat32(),A=T.readFloat32();if(R[3*D+0]=S,R[3*D+1]=-A,R[3*D+2]=-L,w)for(var C=0;C<F;C++){var _,P;T.seek(D*E+N+C*(k?8:4)),k?(_=T.readUint32(),P=T.readUint32()):(_=i.f16(T.readUint16()),P=i.f16(T.readUint16())),y[C][2*D+0]=_,y[C][2*D+1]=P}}var U=new Uint16Array(p.length);for(D=0;D<p.length;D+=3)U[D+0]=p[D+2],U[D+1]=p[D+1],U[D+2]=p[D+0];if(v.addAttribute("position",new THREE.BufferAttribute(R,3)),v.setIndex(new THREE.BufferAttribute(U,1)),v.computeVertexNormals(),w){for(C=0;C<F;C++){var H="uv"+(C>0?C+1:"");v.addAttribute(H,new THREE.BufferAttribute(y[C],2)),v.attributes[H].needsUpdate=!0}v.uvsNeedUpdate=!0}v.buffersNeedUpdate=!0;var I=f[a.materialIndex],O=null;I&&o[I.filename]&&(O=o[I.filename]);var W=n.getMaterial(I,O,e,r);if(!W){if(!l)return[];W=new THREE.MeshLambertMaterial({color:6009320,wireframe:!1,side:THREE.DoubleSide})}var G=new THREE.Mesh(v,W);I&&(G.materialFlags=I.materialFlags,G.materialFilename=I.filename),G.materialName=a.materialName,G.numLods=a.geometry.lods.length,G.lodOverride=t.data.lodOverride,G.flags=a.flags,G.numUV=F,m.push(G)}return m}a.exports={renderGeomChunk:l,getMeshesForFilename:function(e,a,t,n,i,s,d,m){n[e]?m(n[e].meshes,!0,n[e].boundingSphere):function(e,a,t,n,i,s,d){var m=[];t.readFile(e,!1,!1,void 0,void 0,!0).then(a=>{let f=a.buffer;try{if(!f)throw"Could not find MFT entry for "+e;var h=new DataStream(f),u=new r(h,0),c=u.getChunk("modl"),g=u.getChunk("geom"),p=c.data.boundingSphere,v=p.center;p.radius+=Math.sqrt(v[0]*v[0]+Math.sqrt(v[1]*v[1]+v[2]*v[2]));var T=c.data.permutations[0].materials;!function e(a,n){if(a>=T.length)n();else{var i=T[a];o[i.filename]?e(a+1,n):t.readFile(i.filename,!1,!1,void 0,void 0,!0).then(t=>{let s=t.buffer;if(s){var l=new DataStream(s),d=new r(l,0);o[i.filename]=d}e(a+1,n)})}}(0,function(){var e=l(t,g,c,n,i);for(let a of e){if(!(i||2056&a.materialFlags))return;(!s||4!=a.flags&&1!=a.flags)&&m.push(a)}d(m,p)})}catch(a){console.warn("Failed rendering model "+e,a);var E=new THREE.Mesh(new THREE.BoxGeometry(200,2e3,200),new THREE.MeshNormalMaterial);E.flags=4,E.materialFlags=2056,E.lodOverride=[1e6,1e6],m.push(E),d(m)}})}(e,0,t,i,s,d,function(a,t){a&&(n[e]={meshes:a,boundingSphere:t}),m(a,!1,t)})},getFilesUsedByModel:function(e,a,t){var n=[e];a.readFile(e,!1,!1,void 0,void 0,!0).then(a=>{let i=a.buffer;try{if(!i)throw"Could not find MFT entry for "+e;var o=new DataStream(i),s=new r(o,0).getChunk("modl").data.permutations[0].materials;for(let e of s){var l=e.filename;n.push(l),e.textures.forEach(function(e){n.push(e.filename)})}}catch(e){console.warn("Could not export any data",e)}t(n)})}}},{"../format/file/GW2File":18,"./Constants":19,"./MaterialUtils":22,"./MathUtils":23}],25:[function(e,a,t){a.exports={getArrayReader:function(e,a){return function(t,r){var n=[];try{var i=t.readUint32(),o=t.readUint32();if(0==o)return n;var s=t.position-4+o,l=t.position;if(a&&i>a)throw"Array length "+i+" exceeded allowed maximum "+a;l=t.position;t.seek(s),n=t.readType(["[]",e,i],r),t.seek(l)}catch(a){console.warn("getArrayReader Failed loading array",a),console.warn("getArrayReader Failed loading array, structDef",e)}return n}},getRefArrayReader:function(e){return function(a,t){var r=[],n=a.readUint32(),i=a.position+a.readUint32();if(0==n)return r;var o=a.position;a.seek(i);var s=a.readInt32Array(n),l=o-4;a.seek(l),l+=a.readUint32();for(var d=0;d<s.length;d++)if(0!=s[d]){var m=l+4*d+s[d];a.seek(m);try{r.push(a.readStruct(e))}catch(e){r.push(null),console.warn("getRefArrayReader could not find refered data at offset",s[d],e)}}return a.seek(o),r}},getQWordReader:function(){return function(e,a){return e.readUint32()+"-"+e.readUint32()}},getStringReader:function(){return function(e,a){var t=e.position+e.readUint32(),r=e.position;e.seek(t);var n=e.readCString();return e.seek(r),n}},getString16Reader:function(e){return function(a,t){var r=a.position+a.readUint32()+(e||0),n=a.position;a.seek(r);for(var i,o="";a.position+2<a.byteLength&&0!=(i=a.readUint16());)o+=String.fromCharCode(i);return a.seek(n),o}},getPointerReader:function(e){return function(a,t){var r=a.readUint32();if(0==r)return{};var n=a.position-4+r,i=a.position;a.seek(n);var o=a.readStruct(e);return a.seek(i),o}},getFileNameReader:function(){return function(e,a){try{var t=e.position+e.readUint32(),r=e.position;e.seek(t);var n=e.readStruct(["m_lowPart","uint16","m_highPart","uint16","m_terminator","uint16"]),i=65280*(n.m_highPart-256)+(n.m_lowPart-256)+1;return i<0&&(i=0),e.seek(r),i}catch(a){return e.seek(r),-1}}}}},{}],26:[function(e,a,t){a.exports={renderRect:function(e,a,t,r){var n=e.x1-e.x2,i=e.y1-e.y2;r||(r=1);var o=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2,l=a,d=new THREE.BoxGeometry(n,r,i);t=t||new THREE.MeshBasicMaterial({color:16711680,wireframe:!0});var m=new THREE.Mesh(d,t);return m.overdraw=!0,m.position.x=o,m.position.y=l,m.position.z=s,m}}},{}],27:[function(e,a,t){a.exports={getFragmentShader:function(){return["uniform vec2 uvScale;","uniform vec2 offset;","uniform sampler2D texturePicker;","uniform sampler2D texturePicker2;","uniform sampler2D texture1;","uniform sampler2D texture2;","uniform sampler2D texture3;","uniform sampler2D texture4;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"varying vec2 vUv;","varying vec3 vecNormal;","vec3 blend(","vec4 texture1, float a1, vec4 texture2, float a2,","vec4 texture3, float a3, vec4 texture4, float a4)","{","float depth = 2.0;","float alphaMult = 1.0;","float alphaAdd  = 0.0;","a1 *= 4.0;","a2 *= 4.0;","a3 *= 4.0;","a4 *= 4.0;","a1 =  a1+(1.5+texture1.a);","a2 =  a2+(1.5+texture2.a);","a3 =  a3+(1.5+texture3.a);","a4 =  a4+(1.5+texture4.a);","float ma = max(a1,a2);","ma = max(ma,a3);","ma = max(ma,a4);","ma -= depth;","float b1 = max(a1 - ma, 0.0);","float b2 = max(a2 - ma, 0.0);","float b3 = max(a3 - ma, 0.0);","float b4 = max(a4 - ma, 0.0);","return (","texture1.rgb * b1 + texture2.rgb * b2 +","texture3.rgb * b3 + texture4.rgb * b4 ",") / (b1 + b2 + b3 + b4);","}","void main( void ) {","vec2 position = vUv*uvScale;","float edge = 1.0/1024.0;","vec2 compPos = edge + (vUv*0.25 + offset) * (1.0-edge*2.0);","vec4 tp1 = texture2D( texturePicker, compPos);","vec4 tp2 = texture2D( texturePicker2, compPos);","vec4 composite = tp1;","vec4 t1 = texture2D( texture1, position );","vec4 t2 = texture2D( texture2, position );","vec4 t3 = texture2D( texture3, position );","vec4 t4 = texture2D( texture4, position );","vec3 color = blend(","t1, tp1.a,","t2, tp1.b,","t3, tp1.g,","t4, tp1.r",");","color *= 0.5+tp2.r;","gl_FragColor = vec4(color,1.0);",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},getVertexShader:function(){return["varying vec2 vUv;","varying vec3 vecNormal;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main()","{","vUv =  uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vecNormal = (modelMatrix * vec4(normal, 0.0)).xyz;","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n")}}},{}]},{},[8])(8)});
//# sourceMappingURL=T3D-latest.js.map
